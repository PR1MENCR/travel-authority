<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, shrink-to-fit=no"
		/>
		<title>travel</title>
		<link rel="stylesheet" href="style.css">
		<link rel="stylesheet" href="./scss/style.css">
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css"
		/>
		<!-- <link rel="stylesheet" href="custom.css" /> -->

		<!-- FONTS -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Cambo&display=swap" rel="stylesheet">
		

		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
		<!-- firebase -->
		<script src="https://www.gstatic.com/firebasejs/5.0.4/firebase-app.js"></script>
		<script src="https://www.gstatic.com/firebasejs/5.0.4/firebase-firestore.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
	</head>
	<body style="background: #fff !important;">
		<div class="container pb-5 pt-5">
			<div class="btn_wrapp d-flex w-100 ">
				<button id="btn-edit" class="btn btn-primary mr-2"
				>BACK</button>
				<button type="button" class="btn btn-primary ml-auto" data-toggle="modal" data-target="#exampleModal" style="display:none">
					Edit Number
					<i id="pencil" class="fa fa-pencil-square ml-1" aria-hidden="true"></i>
					</button
				>

			</div>
			<div id="modal-container">
				<div class="modal-background">
				  <div class="modal">
					<h3>After download or print, refresh the page to change the number</h3>
					<svg class="modal-svg" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" preserveAspectRatio="none">
											  <rect x="0" y="0" fill="none" width="226" height="162" rx="3" ry="3"></rect>
										  </svg>
				  </div>
				</div>
			  </div>
<!-- Button trigger modal -->

  
		<!-- Modal -->
		<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Travel Authority Number</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				</div>
				<div class="modal-body">
				<form>
					<input id="number" type="text" class="numberEdit w-100 mb-3 mt-2" placeholder="Number">
					<button class="submit w-100 btn btn-success">Submit</button>
				</form>
				</div>
			
			</div>
			</div>
		</div>
			<div id="content" class="main">
		
			</div>

			<br />

			<!-- <button id="btn-print" class="btn btn-success btn-lg"
				>Print & Generate PDF</button
			> -->
				<div class="btn_wrapp d-flex">
					<button id="btn-one" class="btn btn-success btn-lg mr-2"
						>PRINT</button
					>
					<button id="btn-two" class="btn btn-success btn-lg mr-2"
						>EXPORT</button
					>
					<button id="btn-back" class="btn btn-primary btn-lg mr-2"
						>NEW TRAVEL AUTHORITY</button
					>
		
				
			

					<button id="five" class="button instruction ml-auto btn btn-warning btn-lg">Instruction</button>

				</div>

			<!-- <button id="btn-two" class="btn btn-success btn-lg"
				>Generate PDF From iFrame</button
			> -->

			<!-- <iframe
				id="frame"
				style="width: 100%; border: 0; height: 0"
				src="receipt.html"
			></iframe> -->
		</div>
		<div id="modal-container">
			<div class="modal-background">
			  <div class="modal">
				<h3>After download or print, refresh the page to change the number</h3>
				<svg class="modal-svg" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" preserveAspectRatio="none">
										  <rect x="0" y="0" fill="none" width="226" height="162" rx="3" ry="3"></rect>
									  </svg>
			  </div>
			</div>
		  </div>

		  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
		  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
		  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

		<script src="custom.js"></script>
		<script>
			var config = {
			apiKey: "AIzaSyD22Dq5yyUHO9g0fPG0mI8rtILlxDcfPbk",
			authDomain: "qad-db-counter-948cb.firebaseapp.com",
			projectId: "qad-db-counter-948cb",
			storageBucket: "qad-db-counter-948cb.appspot.com",
			messagingSenderId: "415898996431",
			appId: "1:415898996431:web:30ff03edcdf5238202f1ba"
		  };
  
		  firebase.initializeApp(config);
		  const db = firebase.firestore();

  
		  db.settings({ timestampsInSnapshots: true });
  
	  </script>
		<script>

			function ready(){

			
			 var cached = JSON.parse(window.sessionStorage.getItem('pdfinfo-cached'));
			 const wrap = document.querySelector('.wrap')
			 function renderResult(doccached){
				db.collection('pdfcounter').onSnapshot(snapshot => {
					let changes = snapshot.docChanges();
					changes.forEach(change => {
						if(change.type == 'added'){
                      	  renderReservation(change.doc)
						}
					})
				})
				function renderReservation(doc){
					const number = doc.data().count;
					const str = JSON.stringify(number);
					var n = "1234567899";
					// console.log(typeof(number))
					// console.log(str.replace(/(\d{3})(\d{3})(\d{4})/, "$1-$2-$3"));
			

				const main = document.querySelector('.main')
				let div = document.createElement('div')
				div.classList.add('wrap')

				let divHTML = `
				<div class="annex">ANNEX A</div>
				<div class="count_wrap">
					<div class="header">
						<img src="./img/248665212_1036225107231410_5392557891891390226_n.png" alt="">
						<span class="header_title">
							Republic of the Philippines Department of Education
						</span>
					</div>
					<div class="counter">
						<div class="code">No.: <span>${doc.data().count}</span></div>
					</div>
				</div>
						<div class="title">
					<h3>TRAVEL AUTHORITY FOR OFFICIAL TRAVEL</h3>
				</div>
				<table id="demo" class="table ">
					<tbody>
					  <tr>
						<td class="bold">NAME</td>
						<td>
							${doccached.name}
						</td>
					  </tr>
					  <tr>
						<td class="bold">Position/Designation</td>
						<td>${doccached.position}</td>
					  </tr>
					  <tr>
						<td class="bold">Permanent Station</td>
						<td>${doccached.permanentStation}</td>
					  </tr>
					  <tr>
						<td class="bold d-flex flex-column">
							Purpose of Travel
							<span>(must be supported by attachments)</span>	
						</td>
						<td>
							${doccached.purposeOfTravel}
					
						</td>
					  </tr>
					  <tr>
						<td class="bold">Host of Activity</td>
						<td>${doccached.hostofact}</td>
					  </tr>
					  <tr>
						<td class="bold">Inclusive Dates</td>
						<td>${doccached.inclusiveDates}</td>
					  </tr>
					  <tr>
						<td class="bold">Destination</td>
						<td>${doccached.destination}</td>
					  </tr>
					  <tr>
						<td class="bold">Fund Source</td>
						<td>${doccached.fundSource}</td>
					  </tr>
					  <tr>
						<td class=" sign">
							<i>I hereby attest that the information in this form and in the supporting documents attached hereto are tru and correct</i>

							<div class="sign_wrap">
								<span>
									<div class="line">
										<div class="name">
											${doccached.req}
										</div>
										<div class="pos">
											${doccached.reqpos}
										</div>
									</div> 
									Name and Signature of Requesting Employee
								</span>	
								<span><div class="line">${doccached.date}</div> Date of Application</span>	
							</div>
						</td>
					  </tr>
					  <tr>
						<td class=" sign">
							<i>I hereby attest that the information in this form and in the supporting documents attached hereto are tru and correct</i>

							<div class="sign_wrap">
								<span>
									<div class="line">
										<div class="name">
											RITA E. RIDDLE, CESO V
										</div>
										<div class="pos">
											Schools Division Superintendent and concurrent Officer-In-Charge Office of the Assistant Regional Director
										</div>
									</div> 
									Name and Signature of Recommending Authority
								</span>	
								<span><div class="line">${doccached.date}</div> Date of Application</span>	
							</div>
						</td>
					  </tr>
					  <tr>
						<td class=" sign">
							<strong>APPROVED:</strong>

							<div class="sign_wrap">
								<span>
									<div class="line">
										<div class="name">
											WILFREDO E. CABRAL, CESO III
										</div>
										<div class="pos">
											Schools Division Superintendent and concurrent Officer-In-Charge Office of the Assistant Regional Director
										</div>
									</div> 
									Name and Signature of Approving Authority
								</span>	
								<span><div class="line">${doccached.date}</div> Date of Application</span>	
							</div>
						</td>
					  </tr>
				
			
					</tbody>
				  </table>
				`
				  div.innerHTML = divHTML;
				  main.appendChild(div)
				// console.log(doc)
				}
			 }

			 if(!cached){
				return
				renderResult(cached)
			}else{

				renderResult(cached)
			}
			}
			ready();
		</script>
		<script src="./app.js"></script>
		<script>
			$('.button').click(function(){
			var buttonId = $(this).attr('id');
			$('#modal-container').removeAttr('class').addClass(buttonId);
			$('body').addClass('modal-active');
		  })
	  
		  $('#modal-container').click(function(){
			$(this).addClass('out');
			$('body').removeClass('modal-active');
		  });


		  
		  $(document).ready(function () {
        $('#number').keyup(function (event) {
            addHyphen (this);
        });
    });

			function addHyphen (element) {
				let val = $(element).val().split('-').join('');   // Remove dash (-) if mistakenly entered.

				let finalVal = val.match(/.{1,3}/g).join('-');    // Add (-) after 3rd every char.
				$(element).val(finalVal);		// Update the input box.
			}
		  </script>
	</body>
</html>

